<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>iframe Test - EasyCashFlows</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .test-frame { width: 100%; height: 600px; border: 1px solid #ccc; margin: 10px 0; }
        .info { background: #e3f2fd; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .error { background: #ffebee; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #e8f5e8; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>EasyCashFlows iframe Compatibility Test</h1>
    
    <div class="info">
        <strong>Test Purpose:</strong> Verificare se l'applicazione può essere caricata in iframe senza errori "Connection Denied"
    </div>

    <div id="status">Loading test...</div>

    <h2>Direct iframe Test</h2>
    <iframe 
        id="appFrame"
        class="test-frame" 
        src="/"
        onload="handleLoad()"
        onerror="handleError()">
    </iframe>

    <h2>Test Results</h2>
    <div id="results"></div>

    <script>
        let results = document.getElementById('results');
        let status = document.getElementById('status');
        
        function addResult(message, type = 'info') {
            let div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function handleLoad() {
            status.innerHTML = '<div class="success">✅ iframe loaded successfully</div>';
            addResult('✅ iframe load event fired - no Connection Denied error', 'success');
            
            try {
                let frame = document.getElementById('appFrame');
                let frameDoc = frame.contentDocument || frame.contentWindow.document;
                addResult('✅ iframe content accessible - same-origin policy working', 'success');
            } catch (e) {
                addResult('⚠️ iframe content not accessible (expected for security): ' + e.message, 'info');
            }
        }

        function handleError() {
            status.innerHTML = '<div class="error">❌ iframe failed to load</div>';
            addResult('❌ iframe error event fired - Connection Denied likely present', 'error');
        }

        // Test environment info
        addResult(`<strong>Environment Info:</strong><br>
            - URL: ${window.location.href}<br>
            - Hostname: ${window.location.hostname}<br>
            - User Agent: ${navigator.userAgent.substring(0, 100)}...`, 'info');

        // Timeout test
        setTimeout(() => {
            if (!document.getElementById('appFrame').contentDocument && 
                !document.getElementById('appFrame').contentWindow.document) {
                addResult('⏰ iframe timeout - possible Connection Denied', 'error');
            }
        }, 10000);
    </script>
</body>
</html>