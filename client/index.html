<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
    <title>EasyCashFlows - Gestione Flussi Finanziari</title>
    <meta name="description" content="Sistema avanzato di gestione flussi finanziari per PMI italiane con analytics predittive e integrazione FatturaPA" />
    
    <!-- Meta CSP not needed - handled in server headers -->
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1e40af" />
    <meta name="background-color" content="#ffffff" />
    
    <!-- iOS PWA support -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="EasyCashFlows" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    
    <!-- Fonts moved to CSS to avoid CSP issues -->
    
    <!-- React/Hook stability script -->
    <script>
      // CRITICAL: Ensure React context is stable for iframe/reload scenarios  
      window.__REACT_DEVTOOLS_GLOBAL_HOOK__ = window.__REACT_DEVTOOLS_GLOBAL_HOOK__ || {};
      window.__REACT_STRICT_MODE__ = false; // Prevent double-rendering
      
      // Iframe detection and logging
      console.log('[IFRAME CHECK] In iframe:', window.self !== window.top);
      console.log('[IFRAME CHECK] Parent origin:', document.referrer);
      
      // TEMPORARY: Disable iframe fallback to test React app directly
      const DISABLE_IFRAME_FALLBACK = true;
      
      // CRITICAL: Prevent reload crashes in iframe context
      if (window.self !== window.top && !DISABLE_IFRAME_FALLBACK) {
        console.log('[IFRAME] Replit preview detected - applying stability fixes');
        window.__IFRAME_CONTEXT__ = true;
        
        // DIRECT IFRAME FALLBACK: immediate execution without waiting
        const showIframeFallback = () => {
          const rootEl = document.getElementById('root');
          if (rootEl) {
            console.log('[IFRAME] Applying direct fallback UI');
            rootEl.innerHTML = `
              <div style="padding: 20px; text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; box-sizing: border-box;">
                <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; padding: 50px; max-width: 600px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2);">
                  <div style="font-size: 4em; margin-bottom: 20px;">üè¶</div>
                  <h1 style="margin: 0 0 15px 0; font-size: 2.8em; font-weight: 300;">EasyCashFlows</h1>
                  <p style="margin: 0 0 20px 0; font-size: 1.3em; opacity: 0.9; font-weight: 200;">Sistema di Gestione Finanziaria</p>
                  <div style="margin: 30px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; border-left: 4px solid #4CAF50;">
                    <p style="margin: 0; opacity: 0.8; line-height: 1.6;">Per accedere a tutte le funzionalit√† professionali dell'applicazione, aprire in una nuova scheda del browser</p>
                  </div>
                  <button onclick="window.open(window.location.href, '_blank')" style="background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; padding: 18px 35px; border-radius: 30px; font-size: 1.2em; cursor: pointer; box-shadow: 0 6px 20px rgba(76,175,80,0.3); transition: all 0.3s ease; font-weight: 500; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(76,175,80,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(76,175,80,0.3)'">
                    üöÄ Apri Applicazione Completa
                  </button>
                  <div style="margin-top: 40px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.2); display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 0.95em; opacity: 0.7;">
                    <div>üìä Dashboard Analytics</div>
                    <div>üíº Gestione Movimenti</div>
                    <div>üìã Report Finanziari</div>
                    <div>‚öôÔ∏è Configurazioni</div>
                  </div>
                </div>
              </div>
            `;
          }
        };
        
        // Multiple execution strategies for maximum compatibility
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', showIframeFallback);
        } else {
          showIframeFallback();
        }
        setTimeout(showIframeFallback, 100);
        setTimeout(showIframeFallback, 500);
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script>
      // FORCE IMMEDIATE DEBUG - executes before main.tsx
      console.log('üî• HTML SCRIPT EXECUTING - Before main.tsx load');
      document.addEventListener('DOMContentLoaded', () => {
        console.log('üî• DOM READY - main.tsx should execute next');
        const root = document.getElementById('root');
        if (root) {
          root.style.border = '3px solid red';
          root.innerHTML = '<div style="padding:20px;color:blue;font-family:Arial;">üî• DOM READY - Waiting for main.tsx...</div>';
        }
      });
    </script>
    <script type="module" src="/src/main.tsx"></script>
    <!-- Replit development banner removed to fix connection issues -->
  </body>
</html>
